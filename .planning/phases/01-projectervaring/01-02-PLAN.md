---
phase: 01-projectervaring
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/components/ProjectDashboard.tsx
  - src/app/(dashboard)/projects/[id]/page.tsx
  - src/app/api/projects/[id]/dashboard/route.ts
  - src/components/UploadForm.tsx
autonomous: true
requirements:
  - DASH-01
  - DASH-02
  - DASH-03
  - DASH-04
  - VERW-01

must_haves:
  truths:
    - "Bij openen van een project is de Stand van Zaken het eerste en meest prominente element op het dashboard"
    - "Dashboard toont top 10 open actiepunten met 'Bekijk alle' link"
    - "Dashboard toont recente besluiten met 'Bekijk alle' link"
    - "Dashboard toont recente vergaderingen als compacte lijst met titel, datum en korte samenvatting"
    - "Upload pagina toont verwerkingsopties als checkboxes VOOR het uploaden"
    - "Standaard is alleen 'Transcript opschonen' aangevinkt op de upload pagina"
    - "Subprojecten-sectie is verwijderd van de project detail pagina"
  artifacts:
    - path: "src/components/ProjectDashboard.tsx"
      provides: "Restructured dashboard with SVZ hero, action items, decisions, meetings"
      min_lines: 100
    - path: "src/app/(dashboard)/projects/[id]/page.tsx"
      provides: "Project detail page without subprojects section"
      min_lines: 60
    - path: "src/components/UploadForm.tsx"
      provides: "Upload form with pre-upload processing options and new defaults"
      min_lines: 100
  key_links:
    - from: "src/components/ProjectDashboard.tsx"
      to: "react-markdown"
      via: "ReactMarkdown rendering statusSummary as hero"
      pattern: "ReactMarkdown.*statusSummary"
    - from: "src/components/ProjectDashboard.tsx"
      to: "/projects/[id]/action-items"
      via: "Bekijk alle link for action items"
      pattern: "Bekijk alle"
    - from: "src/components/UploadForm.tsx"
      to: "/api/ai/process-transcript"
      via: "POST call with processing options from pre-upload checkboxes"
      pattern: "api/ai/process-transcript"
---

<objective>
Restructure the project dashboard to feature Stand van Zaken as the hero element with streamlined action items, decisions, and meetings sections. Polish the upload flow to show processing options before upload with corrected defaults.

Purpose: Users see the most important project context (Stand van Zaken) immediately upon opening a project, and the upload experience is clear about what AI processing will happen before the file is uploaded.
Output: Redesigned ProjectDashboard.tsx, cleaned up project detail page (no subprojects), polished UploadForm.tsx with pre-upload processing options.
</objective>

<execution_context>
@/Users/guidocroon-talentix/.claude/get-shit-done/workflows/execute-plan.md
@/Users/guidocroon-talentix/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-projectervaring/01-RESEARCH.md
@.planning/phases/01-projectervaring/01-01-SUMMARY.md

@src/components/ProjectDashboard.tsx
@src/app/(dashboard)/projects/[id]/page.tsx
@src/app/api/projects/[id]/dashboard/route.ts
@src/components/UploadForm.tsx
@src/components/ActionItemList.tsx
@src/components/DecisionList.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Restructure project dashboard and clean up project detail page</name>
  <files>
    src/components/ProjectDashboard.tsx
    src/app/(dashboard)/projects/[id]/page.tsx
    src/app/api/projects/[id]/dashboard/route.ts
  </files>
  <action>
**1. Update dashboard API (`src/app/api/projects/[id]/dashboard/route.ts`):**

Add `summary` field to the transcripts query so the dashboard can show a short summary for each recent meeting:
- In the `recentTranscripts` select, add `summary: true` to the selected fields.
- Change `take: 5` to `take: 10` for transcripts (to have more recent meetings available).
- Increase decisions to `take: 10` (was 5) so we can show up to 10 recent decisions.

**2. Restructure `src/components/ProjectDashboard.tsx`:**

Major layout redesign per locked decisions:

**Remove:** The stats grid (5 cards with counts at the top). The Stand van Zaken replaces this as primary orientation element.

**New layout structure:**

```
+--------------------------------------------------+
|  STAND VAN ZAKEN (hero, full width)               |
|  Large prominent section with markdown rendering   |
|  "Bijgewerkt op [date]" subtitle                  |
+--------------------------------------------------+
|  OPEN ACTIEPUNTEN       | RECENTE BESLUITEN      |
|  (top 10, md:grid-cols-2 side by side)            |
|  [ActionItemList]        | [DecisionList]          |
|  "Bekijk alle" link      | "Bekijk alle" link      |
+--------------------------------------------------+
|  RECENTE VERGADERINGEN (full width compact list)  |
|  Title  |  Date  |  Summary snippet (1 line)      |
|  Click navigates to transcript detail              |
+--------------------------------------------------+
```

**Stand van Zaken hero section:**
- Full width card at the top. ALWAYS show this section, even when `statusSummary` is null (show "Nog geen stand van zaken. Upload een transcriptie om te beginnen." placeholder).
- Title: "Stand van Zaken" using `text-lg font-semibold`.
- Use a subtle visual accent: `border-l-4 border-sky-500` on the left side of the card.
- Markdown rendered with `<ReactMarkdown>` inside `prose prose-sm prose-slate max-w-none`.
- Show "Bijgewerkt op [date]" in `text-xs text-slate-400` below the title if `statusUpdatedAt` exists.

**Action items + Decisions section (side by side):**
- `grid md:grid-cols-2 gap-6` layout.
- Action items card: title "Open Actiepunten ({count})" with count from `stats.actionItems.open + stats.actionItems.inProgress`. "Bekijk alle" link to `/projects/${project.id}/action-items`. Use existing `ActionItemList` component. Show the top 10 items as currently returned from dashboard API.
- Decisions card: title "Recente Besluiten ({count})" with `stats.decisions.active` count. "Bekijk alle" link to `/projects/${project.id}/decisions`. Use existing `DecisionList` component.

**Recent meetings section (full width):**
- Title: "Recente Vergaderingen"
- Compact list (not cards). Each item is a clickable `Link` to `/transcripts/${t.id}`.
- Per locked decision: show title, datum, and korte samenvatting. Display:
  - Title: `t.title || t.filename` in `text-sm font-medium`.
  - Date: `t.createdAt` formatted as `nl-NL` in `text-xs text-slate-400`.
  - Summary: `t.summary` (first 120 characters + "..." if longer) in `text-sm text-slate-500 line-clamp-1`.
- If no meetings yet, show "Nog geen vergaderingen" placeholder.
- "Bekijk alle" link at the top pointing to `/transcripts` (or keep existing behavior).

**Remove the "Verslagen" card** from the dashboard. Reports are secondary content accessible via the sidebar/navigation -- the dashboard focuses on Stand van Zaken, action items, decisions, and meetings per user decisions.

**Keep existing functionality intact:**
- The "Transcripties toevoegen" modal (linking unlinked transcripts) should remain.
- Action item status change handlers, decision status change handlers -- keep them.
- The `onRefresh` callback should still work.

**Update the `DashboardData` interface** to include `summary` in the transcripts type:
```typescript
transcripts: Array<{
  id: string
  title: string | null
  filename: string
  status: string
  duration: number | null
  summary: string | null  // ADD THIS
  createdAt: string
}>
```

**3. Clean up project detail page (`src/app/(dashboard)/projects/[id]/page.tsx`):**

- REMOVE the entire "Sub Projects (Folders)" section (the card with "Mappen" heading, subProjects map, and the Link to `/projects/new?parentId=...`).
- REMOVE the `subProjects` state, the `fetchSubProjects()` function, and its call in `useEffect`.
- REMOVE the `any[]` type for subProjects state (it's being deleted).
- KEEP the header card with project name, description, status badge, member management link, "+ Transcriptie" link, and delete button.
- KEEP the `<ProjectDashboard>` component at the bottom.
- Also update the DashboardData interface in this file to match the updated one in ProjectDashboard.tsx (add `summary` to transcripts).
  </action>
  <verify>
Run `npm run build` to verify no TypeScript errors. Run `npm run dev` and navigate to `/projects/[id]` to verify:
1. Stand van Zaken is the first and most prominent section.
2. No stats grid at the top.
3. Action items and decisions appear side by side.
4. Recent meetings show as a compact list with title, date, and summary.
5. No subprojects section visible.
6. "Bekijk alle" links navigate to the correct pages.
  </verify>
  <done>
Dashboard features Stand van Zaken as hero section with left border accent. Stats grid removed. Action items (top 10) and decisions shown side by side with "Bekijk alle" links. Recent meetings displayed as compact list with title, date, summary. Subprojects section completely removed from project detail page.
  </done>
</task>

<task type="auto">
  <name>Task 2: Polish upload flow with pre-upload processing options</name>
  <files>
    src/components/UploadForm.tsx
  </files>
  <action>
**Refactor `src/components/UploadForm.tsx` to move processing options BEFORE upload:**

The current flow is: Upload file -> Show result -> Show AI processing options (post-upload).
The new flow is: Choose options -> Upload file -> Processing starts automatically.

**1. Move processing checkboxes to the pre-upload section:**

Add a "Verwerkingsopties" section BELOW the project selector and ABOVE the drop zone in the pre-upload form (`!result` condition):

```
Upload type toggle: [Audio/Video] [PDF]
Titel (optioneel)
Project (optioneel)
Verwerkingsopties:
  [x] Transcript opschonen         (default ON, always enabled)
  [ ] Actiepunten extraheren       (default OFF)
  [ ] Besluiten extraheren         (default OFF)
  [ ] Verslag genereren            (default OFF)
[Drop zone / file selector]
```

**2. Change default checkbox values (per locked decision):**

- `optCleanTranscript`: new state, default `true`, ALWAYS checked (this represents the base AI processing that cleans the transcript + generates summary). This is a NEW option that was previously implicit.
- `optExtractActionItems`: change default from `true` to `false`.
- `optExtractDecisions`: change default from `true` to `false`.
- `optGenerateReport`: keep default `false`.

The "Transcript opschonen" checkbox should be visually distinct (checked and perhaps with a note like "Aanbevolen" in small text) to signal it's the base operation.

**3. Processing options should be conditionally enabled:**

- "Transcript opschonen" is always available regardless of project selection.
- "Actiepunten extraheren", "Besluiten extraheren", and "Verslag genereren" should be visually disabled (grayed out, `opacity-50`, cursor-not-allowed) when NO project is selected, because these require project context. Show a small tooltip or note: "Selecteer een project voor deze opties".

**4. Auto-start AI processing after upload:**

After the file upload completes and `result` is set:
- If `optCleanTranscript` is true (it almost always will be), automatically call the AI processing endpoint with the selected options. Do NOT wait for the user to click "Verwerk met AI" -- the user already chose their options pre-upload.
- The processing call should use the same endpoint `/api/ai/process-transcript` with the options from the pre-upload checkboxes.
- Show the inline progress indicator (existing `aiStatus === 'processing'` UI).

**5. Simplify the post-upload view:**

Since processing options were already chosen pre-upload, the post-upload view should NOT show the checkboxes again. Instead show:
- Title (editable) + duration badge.
- Project selector (still changeable, but changing it should NOT re-trigger processing).
- AI processing status (processing indicator / completed results / error with retry).
- Transcript text card.
- SRT section (if available).
- Action buttons: "Bekijk details" + "Nieuwe transcriptie".

REMOVE the AI processing checkboxes and "Verwerk met AI" button from the post-upload section entirely. They're now in the pre-upload section.

**6. Keep the `handleNewTranscript()` reset function working:**

When user clicks "Nieuwe transcriptie", reset ALL state including the processing option checkboxes back to their new defaults (`optCleanTranscript: true`, all others `false`).

**7. Update `handleStartAiProcessing`:**

Include the new `optCleanTranscript` option in the API call. The existing `/api/ai/process-transcript` endpoint already handles the `options` object -- just ensure the processing options sent match:
```typescript
options: {
  cleanTranscript: optCleanTranscript,  // new
  extractActionItems: optExtractActionItems,
  extractDecisions: optExtractDecisions,
  generateReport: optGenerateReport,
}
```

Note: The `cleanTranscript` option maps to the existing `processTranscript()` call in the API route which always runs. The option simply controls whether the user explicitly requested it. If `optCleanTranscript` is false and no other options are checked, skip AI processing entirely.

**8. Auto-trigger after upload:**

In the existing `handleAudioUpload` and `handlePdfUpload` functions, after `setResult(data)` succeeds:
- Check if any processing option is enabled (`optCleanTranscript || optExtractActionItems || optExtractDecisions || optGenerateReport`).
- If so, and if a project is selected (for options beyond transcript cleaning), or if just transcript cleaning is selected, automatically call `handleStartAiProcessing()` in a `useEffect` that watches for `result` changes.
- Use a `useEffect` with dependency on `result` to trigger: `if (result && shouldAutoProcess) { handleStartAiProcessing() }`. Use a ref `autoProcessRef` to track whether auto-processing should happen (set to true before upload, consumed once after result arrives).

All text in Dutch. Follow existing component patterns.
  </action>
  <verify>
Run `npm run build` to verify no TypeScript errors. Run `npm run dev` and navigate to `/` (upload page) to verify:
1. Processing option checkboxes appear before the drop zone.
2. Only "Transcript opschonen" is checked by default.
3. Action items, decisions, report checkboxes are disabled when no project selected.
4. After uploading, AI processing starts automatically with the pre-selected options.
5. Post-upload view does NOT show processing checkboxes (they were pre-upload).
6. "Nieuwe transcriptie" resets to defaults correctly.
  </verify>
  <done>
Upload page shows processing options (checkboxes) before the file drop zone. Default is only "Transcript opschonen" checked. Other options disabled without project selection. After upload, AI processing starts automatically. Post-upload view shows progress/results without duplicate checkboxes.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors.
2. Project dashboard shows Stand van Zaken as hero element (first, most prominent).
3. Dashboard shows action items and decisions side by side with "Bekijk alle" links.
4. Dashboard shows recent meetings as compact list with title, date, summary.
5. No subprojects section on project detail page.
6. Upload page shows processing checkboxes before drop zone.
7. Only "Transcript opschonen" checked by default.
8. AI processing auto-starts after upload with pre-selected options.
</verification>

<success_criteria>
- Stand van Zaken is the hero section, visually dominant on the project dashboard.
- Action items (top 10) and decisions displayed side by side with "Bekijk alle" links.
- Recent meetings show as compact list (title, date, summary).
- Upload flow has pre-upload processing options with "Transcript opschonen" as default.
- Processing options beyond transcript cleaning disabled when no project selected.
- AI processing starts automatically after upload.
- No subprojects concept remains in the UI.
- No TypeScript build errors.
</success_criteria>

<output>
After completion, create `.planning/phases/01-projectervaring/01-02-SUMMARY.md`
</output>
